<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WPS AI | Institutional Bright Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,600;0,700;1,400&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  /* LIGHT THEME PALETTE */
  --bg: #f1f5f9;
  --surface: #ffffff;
  --surface2: #f8fafc;
  --surface3: #e2e8f0;
  --border: #cbd5e1;
  --border2: #94a3b8;
  --text: #0f172a;
  --text2: #475569;
  --text3: #64748b;
  --gold: #b45309; 
  --gold-dim: rgba(180, 83, 9, 0.08);
  --green: #15803d;
  --green-dim: rgba(21, 128, 61, 0.1);
  --red: #b91c1c;
  --red-dim: rgba(185, 28, 28, 0.1);
  --blue: #2563eb;
  --nav-h: 64px;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'IBM Plex Mono',monospace;background:var(--bg);color:var(--text);min-height:100vh;}

/* NAVIGATION */
.nav{position:fixed;top:0;left:0;right:0;height:var(--nav-h);background:rgba(255,255,255,0.9);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);z-index:100;display:flex;align-items:center;padding:0 20px;}
.nav-brand{font-family:'Syne',sans-serif;font-weight:800;font-size:18px;color:var(--text);margin-right:32px;}
.nav-brand span{color:var(--gold);}
.nav-tabs{display:flex;gap:5px;flex:1;}
.nav-tab{padding:8px 16px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;border:none;background:transparent;color:var(--text3);transition:0.2s;}
.nav-tab.active{background:var(--gold-dim);color:var(--gold);border:1px solid var(--gold);}

/* MAIN */
.main{padding-top:calc(var(--nav-h) + 32px);padding-bottom:80px;max-width:860px;margin:0 auto;padding-left:20px;padding-right:20px;position:relative;z-index:1;}
.page{display:none;animation:fadeUp 0.35s ease both;}
.page.active{display:block;}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:translateY(0);}}

/* SEARCH & CARDS */
.card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:24px;margin-bottom:16px;box-shadow: 0 1px 3px rgba(0,0,0,0.1);}
.search-box{display:flex;background:var(--surface);border:2px solid var(--border);border-radius:12px;overflow:hidden;transition: border-color 0.2s;}
.search-box:focus-within{border-color: var(--gold);}
.search-input{flex:1;background:transparent;border:none;outline:none;padding:18px 20px;font-family:'IBM Plex Mono',monospace;font-size:18px;font-weight:700;color:var(--text);text-transform:uppercase;}
.search-btn{padding:18px 24px;background:var(--gold);border:none;color:#fff;font-family:'IBM Plex Mono',monospace;font-size:12px;font-weight:700;letter-spacing:1px;cursor:pointer;}

/* GROUNDING SOURCES */
.grounding-box{background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:20px;margin-top:20px;}
.source-link{display:block;font-size:11px;color:var(--blue);margin-bottom:6px;text-decoration:none;font-weight:600;}
</style>
</head>
<body>

<nav class="nav">
  <div class="nav-brand">WPS<span>.</span>AI</div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showPage('scorer',this)">‚ö° SCORER</button>
    <button class="nav-tab" onclick="showPage('compare',this)">‚öñ COMPARE</button>
    <button class="nav-tab" onclick="showPage('checklist',this)">‚òë CHECKLIST</button>
    <button class="nav-tab" onclick="showPage('journal',this)">üìì JOURNAL</button>
    <button class="nav-tab" onclick="showPage('watchlist',this)">üëÅ WATCHLIST</button>
  </div>
</nav>

<div class="main">
  <div class="page active" id="page-scorer">
    <div style="margin-bottom:24px;">
      <h1 style="font-family:'Syne'; font-size:32px;">AI Stock Scorer</h1>
      <p style="color:var(--text3)">Institutional 7-Pillar Analysis ¬∑ Feb 2026</p>
    </div>

    <div class="card">
      <div style="margin-bottom:15px; display:flex; align-items:center; gap:10px;">
        <span style="font-size:10px; font-weight:700; color:var(--text3)">PAID API KEY:</span>
        <input type="password" id="geminiKey" style="flex:1; padding:8px; border:1px solid var(--border); border-radius:6px; font-size:11px;" placeholder="AIza...">
      </div>
      <div class="search-box">
        <input class="search-input" id="stockInput" placeholder="e.g. LAURUSLABS" onkeydown="if(event.key==='Enter')analyzeStock()"/>
        <button class="search-btn" id="analyzeBtn" onclick="analyzeStock()">ANALYZE LIVE ‚Üí</button>
      </div>
    </div>

    <div id="loading" style="display:none; text-align:center; padding:40px; color:var(--gold); font-weight:700; letter-spacing:1px;">
        SEARCHING LIVE 2026 MARKET DATA...
    </div>
    
    <div id="resultsPanel"></div>
  </div>

  <div class="page" id="page-compare"><div class="card"><h2>Comparison Tool</h2><p>Restoring logic...</p></div></div>
  <div class="page" id="page-checklist"><div class="card"><h2>Weekly Checklist</h2><p>Restoring logic...</p></div></div>
  <div class="page" id="page-journal"><div class="card"><h2>Trade Journal</h2><p>Restoring logic...</p></div></div>
  <div class="page" id="page-watchlist"><div class="card"><h2>Watchlist</h2><p>Restoring logic...</p></div></div>
</div>

<script>
// Restoration of core logic from index.html
function showPage(id, btn) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    document.getElementById('page-'+id).classList.add('active');
    btn.classList.add('active');
}

async function analyzeStock() {
    const symbol = document.getElementById('stockInput').value.trim().toUpperCase();
    const apiKey = document.getElementById('geminiKey').value.trim();
    if(!symbol || !apiKey) return alert("Missing symbol or API key.");

    const load = document.getElementById('loading');
    const panel = document.getElementById('resultsPanel');
    load.style.display = 'block';
    panel.innerHTML = '';

    try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ parts: [{ text: "Analyze NSE stock " + symbol + " using 7-Pillar WPS Methodology. Use live Feb 2026 data. Return JSON." }] }],
                tools: [{ google_search: {} }], // Enable real-time web access
                generationConfig: { temperature: 0.2 }
            })
        });

        const data = await response.json();
        
        // Error handling for Paid Tier
        if (!data.candidates || data.candidates.length === 0) {
            throw new Error("No data returned. Check API quota or safety filters.");
        }

        const candidate = data.candidates[0];
        const rawText = candidate.content.parts[0].text;
        const result = JSON.parse(rawText.match(/\{[\s\S]*\}/)[0]);

        renderResult(result, candidate.groundingMetadata);
    } catch (e) {
        alert("Error: " + e.message);
    } finally {
        load.style.display = 'none';
    }
}

function renderResult(d, meta) {
    const panel = document.getElementById('resultsPanel');
    panel.innerHTML = `
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <div>
                    <h2 style="font-size:32px; font-weight:800; color:var(--text);">${d.symbol}</h2>
                    <p style="color:var(--text3);">${d.company || ''}</p>
                </div>
                <div style="text-align:right;">
                    <div style="font-size:24px; font-weight:800; color:var(--gold);">${d.cmp || d.price}</div>
                    <div style="font-size:10px; font-weight:700; color:var(--green); background:var(--green-dim); padding:2px 8px; border-radius:4px; display:inline-block;">LIVE 2026</div>
                </div>
            </div>

            <div style="background:var(--surface2); border:1px solid var(--border); border-radius:12px; padding:20px; margin-bottom:20px;">
                <div style="font-size:10px; font-weight:700; color:var(--text3); letter-spacing:2px; margin-bottom:8px;">WPS CONVICTION SCORE</div>
                <div style="font-size:48px; font-weight:800; color:var(--gold); line-height:1;">${d.wps}%</div>
                <div style="font-size:16px; font-weight:700; margin-top:10px;">${d.verdict}</div>
            </div>

            <div class="grounding-box">
                <div style="font-size:10px; font-weight:700; color:var(--gold); margin-bottom:10px;">GROUNDED SOURCES (LIVE WEB):</div>
                ${meta?.groundingChunks?.map(c => `<a href="${c.web.uri}" target="_blank" class="source-link">üîó ${c.web.title}</a>`).join('') || 'Fetching live sources...'}
            </div>
        </div>
    `;
}
</script>
</body>
</html>