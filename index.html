<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WPS AI | Institutional Trading Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,600;0,700;1,400&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #060810;
  --surface: #0d1117;
  --surface2: #141922;
  --surface3: #1c2433;
  --border: #1e2d40;
  --border2: #263650;
  --text: #e2eaf5;
  --text2: #6b83a0;
  --text3: #3a4f68;
  --gold: #e8b84b;
  --gold-dim: rgba(232,184,75,0.12);
  --green: #34d48a;
  --green-dim: rgba(52,212,138,0.1);
  --red: #f04a4a;
  --red-dim: rgba(240,74,74,0.1);
  --amber: #f5a623;
  --amber-dim: rgba(245,166,35,0.1);
  --blue: #4a9eff;
  --blue-dim: rgba(74,158,255,0.1);
  --purple: #b87fff;
  --nav-h: 64px;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;}
body{font-family:'IBM Plex Mono',monospace;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}

/* BG */
.bg-grid{position:fixed;inset:0;background-image:linear-gradient(rgba(232,184,75,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(232,184,75,0.03) 1px,transparent 1px);background-size:60px 60px;animation:gridMove 25s linear infinite;pointer-events:none;z-index:0;}
@keyframes gridMove{0%{transform:translateY(0);}100%{transform:translateY(60px);}}
.bg-glow{position:fixed;top:-200px;left:50%;transform:translateX(-50%);width:900px;height:500px;background:radial-gradient(ellipse,rgba(232,184,75,0.05) 0%,transparent 70%);pointer-events:none;z-index:0;}

/* NAV */
.nav{position:fixed;top:0;left:0;right:0;height:var(--nav-h);background:rgba(6,8,16,0.92);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);z-index:100;display:flex;align-items:center;padding:0 20px;gap:0;}
.nav-brand{font-family:'Syne',sans-serif;font-weight:800;font-size:16px;color:var(--text);margin-right:32px;white-space:nowrap;}
.nav-brand span{color:var(--gold);}
.nav-tabs{display:flex;gap:2px;flex:1;overflow-x:auto;}
.nav-tab{padding:8px 16px;border-radius:8px;font-size:12px;font-weight:600;letter-spacing:1px;cursor:pointer;border:none;background:transparent;color:var(--text3);white-space:nowrap;transition:all 0.18s;font-family:'IBM Plex Mono',monospace;}
.nav-tab:hover{color:var(--text2);background:var(--surface2);}
.nav-tab.active{background:var(--gold-dim);color:var(--gold);border:1px solid rgba(232,184,75,0.25);}

/* MAIN */
.main{padding-top:calc(var(--nav-h) + 32px);padding-bottom:80px;max-width:860px;margin:0 auto;padding-left:20px;padding-right:20px;position:relative;z-index:1;}

/* PAGE SECTIONS */
.page{display:none;animation:fadeUp 0.35s ease both;}
.page.active{display:block;}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:translateY(0);}}

/* PAGE HEADER */
.page-header{margin-bottom:32px;}
.page-eyebrow{font-size:10px;letter-spacing:4px;color:var(--gold);text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;gap:8px;}
.page-eyebrow::before{content:'';width:20px;height:1px;background:var(--gold);}
.page-title{font-family:'Syne',sans-serif;font-size:clamp(24px,4vw,36px);font-weight:800;letter-spacing:-1px;line-height:1.1;}
.page-title em{font-style:normal;color:var(--gold);}
.page-sub{font-size:12px;color:var(--text3);margin-top:6px;letter-spacing:0.5px;}

/* SEARCH BOX */
.apikey-banner{background:var(--surface);border:1px solid var(--border2);border-radius:12px;padding:16px 20px;margin-bottom:16px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
.apikey-banner-label{font-size:10px;letter-spacing:3px;color:var(--gold);text-transform:uppercase;white-space:nowrap;flex-shrink:0;}
.apikey-banner-input{flex:1;min-width:200px;background:var(--surface2);border:1px solid var(--border2);border-radius:8px;padding:10px 14px;font-family:'IBM Plex Mono',monospace;font-size:13px;color:var(--text);outline:none;transition:border-color 0.2s;}
.apikey-banner-input:focus{border-color:var(--gold);}
.search-box{display:flex;background:var(--surface);border:1px solid var(--border2);border-radius:12px;overflow:hidden;}
.search-input{flex:1;background:transparent;border:none;outline:none;padding:18px 20px;font-family:'IBM Plex Mono',monospace;font-size:18px;font-weight:600;color:var(--text);letter-spacing:2px;text-transform:uppercase;}
.search-btn{padding:18px 24px;background:var(--gold);border:none;color:#000;font-family:'IBM Plex Mono',monospace;font-size:12px;font-weight:700;letter-spacing:2px;cursor:pointer;}

/* RESULTS */
.results{display:none;animation:fadeUp 0.4s ease both;}
.results.active{display:block;}
.stock-header{background:var(--surface);border:1px solid var(--border2);border-radius:14px;padding:22px 24px;margin-bottom:14px;display:flex;align-items:center;gap:16px;flex-wrap:wrap;}
.sym-big{font-size:26px;font-weight:700;color:var(--gold);letter-spacing:2px;}
.score-hero{background:var(--surface);border:1px solid var(--border2);border-radius:14px;padding:28px 24px;margin-bottom:14px;display:flex;align-items:center;gap:28px;}
.ring-num{font-size:34px;font-weight:700;line-height:1;}
.verdict-wrap{flex:1;}
.vmain{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;margin-bottom:8px;}

/* PILLARS */
.pillars-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px;}
.pcardi{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px 18px;}
.pval{font-size:18px;font-weight:700;}

/* GROUNDING */
.grounding-box{background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:20px;margin-top:20px;}
.source-link{display:block;font-size:11px;color:var(--blue);margin-bottom:6px;text-decoration:none;}

/* LOADING */
.loading-panel{display:none;background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:36px;text-align:center;}
.loading-panel.active{display:block;}
.loader-sym{font-size:24px;color:var(--gold);animation:blink 1.4s infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:0.3;}}
</style>
</head>
<body>

<div class="bg-grid"></div>
<div class="bg-glow"></div>

<nav class="nav">
  <div class="nav-brand">WPS<span>.</span>AI</div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showPage('scorer',this)">‚ö° SCORER</button>
    <button class="nav-tab" onclick="showPage('compare',this)">‚öñ COMPARE</button>
    <button class="nav-tab" onclick="showPage('checklist',this)">‚òë CHECKLIST</button>
    <button class="nav-tab" onclick="showPage('journal',this)">üìì JOURNAL</button>
    <button class="nav-tab" onclick="showPage('watchlist',this)">üëÅ WATCHLIST</button>
  </div>
</nav>

<div class="main">
  <div class="page active" id="page-scorer">
    <div class="page-header">
      <div class="page-eyebrow">Institutional Methodology v2.1</div>
      <div class="page-title">AI <em>Stock</em> Scorer</div>
      <div class="page-sub">// SEARCH GROUNDING ENABLED: ANALYSING LIVE 2026 DATA</div>
    </div>

    <div class="apikey-banner">
      <div class="apikey-banner-label">üîë Gemini API Key</div>
      <input class="apikey-banner-input" id="geminiKey" type="password" placeholder="AIza..."/>
      <label style="font-size:11px; color:var(--text3); cursor:pointer;"><input type="checkbox" id="rememberKey" onchange="handleRememberKey()"/> Remember</label>
    </div>

    <div class="search-box">
      <input class="search-input" id="stockInput" placeholder="e.g. LAURUSLABS" onkeydown="if(event.key==='Enter')analyzeStock()"/>
      <button class="search-btn" id="analyzeBtn" onclick="analyzeStock()">ANALYZE ‚Üí</button>
    </div>

    <div class="loading-panel" id="loadingPanel">
      <div class="loader-sym">SEARCHING LIVE WEB & ANALYSING...</div>
    </div>

    <div class="results" id="resultsPanel"></div>
  </div>

  <div class="page" id="page-compare"><div class="page-header"><div class="page-title">Compare <em>Stocks</em></div></div></div>
  <div class="page" id="page-checklist"><div class="page-header"><div class="page-title">Weekly <em>Checklist</em></div></div></div>
  <div class="page" id="page-journal"><div class="page-header"><div class="page-title">Trade <em>Journal</em></div></div></div>
  <div class="page" id="page-watchlist"><div class="page-header"><div class="page-title">My <em>Watchlist</em></div></div></div>
</div>

<script>
const SYSTEM_PROMPT = `You are a professional stock analyst. Analyze the stock using the 7-Pillar WPS Methodology. 
You MUST use GOOGLE SEARCH GROUNDING to retrieve the live price, recent news, and FII/DII activity for Feb 2026.
Return ONLY JSON:
{
  "symbol": "SYM", "company": "Name", "cmp": "‚ÇπXXX", "wps": 0-100, "verdict": "Text",
  "pillars": [{"id":1, "name":"RS", "score":80, "reason":"..."}]
}`;

function showPage(id, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  btn.classList.add('active');
}

async function analyzeStock() {
  const symbol = document.getElementById('stockInput').value.trim().toUpperCase();
  const apiKey = document.getElementById('geminiKey').value.trim();
  if (!symbol || !apiKey) return alert("Missing symbol or API key");

  document.getElementById('loadingPanel').classList.add('active');
  document.getElementById('resultsPanel').classList.remove('active');

  try {
    const result = await callGemini(symbol, apiKey);
    renderResult(result);
  } catch (err) {
    alert("Error: " + err.message);
  } finally {
    document.getElementById('loadingPanel').classList.remove('active');
  }
}

async function callGemini(symbol, apiKey) {
  // Integrated Google Search Grounding to fix outdated prices
  const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      contents: [{ parts: [{ text: SYSTEM_PROMPT + "\n\nAnalyze NSE: " + symbol }] }],
      tools: [{ google_search: {} }], // THE FIX: Enables real-time web access
      generationConfig: { temperature: 1.0 } // Recommended for synthesis
    })
  });

  const data = await response.json();
  const candidate = data.candidates[0];
  const rawText = candidate.content.parts[0].text;
  const jsonMatch = rawText.match(/\{[\s\S]*\}/);
  const result = JSON.parse(jsonMatch[0]);

  // Capture grounding metadata citations
  result.sources = candidate.groundingMetadata?.groundingChunks?.map(c => ({
    title: c.web.title,
    url: c.web.uri
  })) || [];

  return result;
}

function renderResult(d) {
  const panel = document.getElementById('resultsPanel');
  panel.innerHTML = `
    <div class="stock-header">
      <div class="sym-big">${d.symbol}</div>
      <div style="flex:1"><strong>${d.company}</strong> | CMP: ${d.cmp}</div>
    </div>
    <div class="score-hero">
      <div class="ring-num">${d.wps}</div>
      <div class="verdict-wrap"><div class="vmain">${d.verdict}</div></div>
    </div>
    <div class="pillars-grid">
      ${d.pillars.map(p => `
        <div class="pcardi">
          <div class="pval">${p.score}%</div>
          <div style="font-size:12px; font-weight:700">${p.name}</div>
          <div style="font-size:11px; color:var(--text2); margin-top:5px">${p.reason}</div>
        </div>
      `).join('')}
    </div>
    <div class="grounding-box">
      <div style="font-size:10px; color:var(--gold); margin-bottom:10px">LIVE GROUNDED SOURCES</div>
      ${d.sources.map(s => `<a href="${s.url}" target="_blank" class="source-link">üîó ${s.title}</a>`).join('')}
    </div>
  `;
  panel.classList.add('active');
}

function handleRememberKey() {
  const key = document.getElementById('geminiKey').value;
  if(document.getElementById('rememberKey').checked) localStorage.setItem('wps_key', key);
}

window.onload = () => {
  const saved = localStorage.getItem('wps_key');
  if(saved) {
    document.getElementById('geminiKey').value = saved;
    document.getElementById('rememberKey').checked = true;
  }
};
</script>
</body>
</html>